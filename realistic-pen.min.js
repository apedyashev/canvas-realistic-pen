function RealisticPen(a,b){function c(a,b){function c(){var a;l.lineWidth=w.brushSize,l.strokeStyle="rgba("+w.penColor[0]+", "+w.penColor[1]+", "+w.penColor[2]+",  "+w.brushPressure+")";for(a=0;a<q.length;a++)l.beginPath(),l.moveTo(q[a].dx,q[a].dy),q[a].ax=(q[a].ax+(q[a].dx-m)*q[a].div)*q[a].ease,q[a].dx-=q[a].ax,q[a].ay=(q[a].ay+(q[a].dy-n)*q[a].div)*q[a].ease,q[a].dy-=q[a].ay,l.lineTo(q[a].dx,q[a].dy),l.stroke();window.isPressed}t=a.parentNode,b&&(w=h(w,b)),w.penColor=i(w.penColor),s=a,l=s.getContext("2d"),g(),l.globalCompositeOperation="source-over",m=s.width/2,n=s.height/2,q=[];for(var d=0;d<w.brushesCount;d++)q.push({dx:s.width/2,dy:s.height/2,ax:0,ay:0,div:.1,ease:.5+.005*d});r=setInterval(c,1e3/90)}function d(a,b){o=m=a,p=n=b;for(var c=0;c<q.length;c++)q[c].dx=a,q[c].dy=b}function e(a,b){m=a,n=b}function f(a,b){if(o===a&&p===b){var c,d=w.brushSize/2;for(c=0;c<q.length;c++)l.beginPath(),l.arc(a,b,d,0,2*Math.PI,!1),l.fillStyle=l.strokeStyle,l.fill(),l.lineWidth=1,l.strokeStyle=l.strokeStyle,l.stroke()}}function g(){var a=function(a){var e=k(s);d(a.pageX-e.left,a.pageY-e.top),s.addEventListener("mousemove",b,!1),s.addEventListener("mouseup",c,!1),window.isPressed=!0},b=function(a){var b=k(s);e(a.pageX-b.left,a.pageY-b.top)},c=function(a){var d=k(s);f(a.pageX-d.left,a.pageY-d.top),s.removeEventListener("mousemove",b,!1),s.removeEventListener("mouseup",c,!1),window.isPressed=!1},g=function(a){if(1==a.touches.length){a.preventDefault();var b=k(s);d(a.touches[0].pageX-b.left,a.touches[0].pageY-b.top),s.addEventListener("touchmove",h,!1),s.addEventListener("touchend",i,!1)}},h=function(a){if(1==a.touches.length){a.preventDefault();var b=k(s);e(a.touches[0].pageX-b.left,a.touches[0].pageY-b.top)}},i=function(a){0===a.touches.length&&(a.preventDefault(),f(),s.removeEventListener("touchmove",h,!1),s.removeEventListener("touchend",i,!1))},j=function(){s.width=t.offsetWidth?t.offsetWidth:u,s.height=t.offsetHeight?t.offsetHeight:v};s.addEventListener("mousedown",a,!1),s.addEventListener("touchstart",g,!1),window.addEventListener("resize",j,!1),j()}function h(a,b){var c,d;a||(a={}),b||(b={});for(c in b)d=b[c],a[c]=d;return a}function i(a){var b=[0,0,0];return/^#./.test(a)?b=j(a):/^rgb\(./.test(a)?b=a.substring(4,a.length-1).replace(/ /g,"").split(","):/^rgba\(./.test(a)?(b=a.substring(5,a.length-1).replace(/ /g,"").split(","),b.pop()):"[object Array]"===Object.prototype.toString.call(a)&&(b=a),b}function j(a){var b=/^#?([a-f\d])([a-f\d])([a-f\d])$/i;a=a.replace(b,function(a,b,c,d){return b+b+c+c+d+d});var c=/^#?([a-f\d]{2})([a-f\d]{2})([a-f\d]{2})$/i.exec(a);return c?[parseInt(c[1],16),parseInt(c[2],16),parseInt(c[3],16)]:[0,0,0]}function k(a){var b,c,d={top:0,left:0},e=a&&a.ownerDocument,f=function(a){return null!==a&&a===a.window},g=function(a){return f(a)?a:9===a.nodeType&&a.defaultView};if(e)return b=e.documentElement,"undefined"!=typeof a.getBoundingClientRect&&(d=a.getBoundingClientRect()),c=g(e),{top:d.top+c.pageYOffset-b.clientTop,left:d.left+c.pageXOffset-b.clientLeft}}var l=null,m=null,n=null,o=null,p=null,q=null,r=null,s=null,t=null,u=200,v=200,w={penColor:[0,0,0],brushPressure:1,brushSize:3,brushesCount:4};this.destroy=function(){clearInterval(r)},this.setPenColor=function(a){w.penColor=i(a)},this.setBrushPressure=function(a){w.brushPressure=a},this.setBrushSize=function(a){w.brushSize=a},this.setBrushesCount=function(a){w.brushesCount=a},c(a,b)}